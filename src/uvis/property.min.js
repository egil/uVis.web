var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i};define(["require","exports","uvis/util/promise"],function(n,t,i){var u=i,r=u.uvis.util,f;(function(n){var t=function(){function n(n,t){this._key=n,this._value=t,this._subscribers=[]}return Object.defineProperty(n.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this._value},set:function(n){this.value!==n&&(this._value=n,this.notify())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"calculated",{get:function(){return new r.Promise(this)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"state",{get:function(){return"current"},enumerable:!0,configurable:!0}),n.prototype.subscribe=function(n){if(this._subscribers.indexOf(n)!==-1)throw new Error("Already subscribed");return this._subscribers.push(n),this},n.prototype.unsubscribe=function(n){var t=this._subscribers.indexOf(n);return t!==-1&&this._subscribers.splice(t,1),this},n.prototype.notify=function(){var n=this;this._subscribers.forEach(function(t){return t(n)})},n}(),i;n.Property=t,i=function(n){function t(t,i){n.call(this,t),this._isStale=!0,this._calculatorFunc=i}return __extends(t,n),Object.defineProperty(t.prototype,"state",{get:function(){return this._updating?"updating":"current"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"calculated",{get:function(){var n=this,t=new r.Promise;return this._updating?t.failPromise("Property is updating, possible cyclic dependency. Property: "+this.key):(this._updating=!0,this._calculatorFunc().done(function(i){n.value=i,n._updating=!1,t.fulfill(n)})),t},enumerable:!0,configurable:!0}),t}(t),n.CalculatedProperty=i})(t.uvis||(t.uvis={})),f=t.uvis})